---
output:
  pdf_document: default
  html_document: default
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(cowplot)
```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
tree_order <- read.csv("~/master/for_anna/Tree_label_ordered.csv")
tree_order$Tree_50 <- gsub(" genomic", "", tree_order$Tree_50)
tree_order$Tree_80 <- gsub(" genomic", "", tree_order$Tree_80)
tree_order$Tree_50 <- gsub(" ", "_", tree_order$Tree_50)
tree_order$Tree_80 <- gsub(" ", "_", tree_order$Tree_80)

files <- list.files("~/master/for_anna/identityTable/", pattern = ".txt")


df_list <- list()

for (i in 1:length(files)) {
    df <- read.table(paste("~/master/for_anna/identityTable/", files[[i]], sep = ""))
    df_list[[i]] <- df
}

df_compiled <- bind_rows(df_list)

df_compiled$V7 <- NULL
df_compiled$V10 <- NULL

colnames(df_compiled) <- c("genome1", "a1", "b1", "genome2", "a2", "b2", "aai_id", 
    "aai_af", "ani_id", "ani_af", "probability")


df_rbh_list <- list()
i <- 1
genomes <- unique(df_compiled$genome1) 

for (genome in genomes){
  
  df_genome1 <- df_compiled %>%
    filter(genome1 == genome) %>%
    select(genome2, aai_id, aai_af, ani_id, ani_af, probability) 
  
  df_genome2 <- df_compiled %>%
    filter(genome2 == genome)%>%
    select(genome1, aai_id, aai_af, ani_id, ani_af, probability)  %>%
    rename(genome2 = genome1)
  
  df_rbh <- bind_rows(df_genome1, df_genome2) %>%
    group_by(genome2) %>%
    mutate(aai_id = mean(aai_id)) %>%
    mutate(aai_af = mean(aai_af)) %>%
    mutate(ani_id = mean(ani_id)) %>%
    mutate(ani_af = mean(ani_af)) %>%
    ungroup() %>%
    distinct() 
  
  df_rbh$genome1 <- genome
  
  df_rbh_list[[i]] <- df_rbh
  
  i <- i + 1
}

df_rbh_final <- bind_rows(df_rbh_list) 
```

## AAI

- Mutiplied AAI and Alginment Length, then only showed values between 30 and 50

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df_rbh_final$genome1 <- factor(as.character(df_rbh_final$genome1), levels = tree_order$Tree_80[1:34])
df_rbh_final$genome2 <- factor(as.character(df_rbh_final$genome2), levels = tree_order$Tree_80[1:34])

df_rbh_final <- df_rbh_final %>%
  mutate(aai_id_af = aai_id * aai_af)

## CHANGE THESE VALUES TO CHANGE CUTOFFS
df_rbh_final <- df_rbh_final %>%
  mutate(aai_id_adj = if_else(aai_id_af < 30, 30, aai_id_af)) %>%
  mutate(aai_id_adj = if_else(aai_id_adj > 50, 50, aai_id_adj)) 

p1 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = aai_id_adj)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p1
```

\newpage

## ANI

- Mutiplied ANI and Alginment Length, then only showed values between 15 and 60

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df_rbh_final <- df_rbh_final %>%
  mutate(ani_id_af = ani_id * ani_af)

## CHANGE THESE VALUES TO CHANGE CUTOFFS
df_rbh_final <- df_rbh_final %>%
  mutate(ani_id_adj = if_else(ani_id_af < 15, 15, ani_id_af)) %>%
  mutate(ani_id_adj = if_else(ani_id_adj > 60, 60, ani_id_adj)) 

p2 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = ani_id_adj)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p2
```

\newpage

## AAI

- Only AAI

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p3 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = aai_id)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p3
```

\newpage

## ANI

- Only ANI

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p4 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = ani_id)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p4
```


\newpage

## AAI Alignment fraction

- Only AAI alignment fraction

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p5 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = aai_af)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p5
```

\newpage

## ANI Alignment fraction

- Only ANI alignment fraction

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p6 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = ani_af)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p6
```

\newpage

## ANI with 40% cutoff

- Only ANI, but with all value lower than 85 set to 85

```{r, echo=FALSE, message=FALSE, warning=FALSE}
df_rbh_final <- df_rbh_final %>%
  mutate(aai_id_cutoff = if_else(aai_id < 85, 85, aai_id)) 

p7 <- ggplot(data = df_rbh_final, aes(x = genome1, y = genome2)) + geom_tile(aes(fill = aai_id_cutoff)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 1, size = 18), 
          axis.text.y = element_text(size = 20), 
      axis.title.x = element_blank(), 
      axis.title.y = element_blank()) + 
    theme(legend.key.size = unit(2, "cm"), 
        legend.text = element_text(size = 20),
        legend.title = element_text(size = 30)) + 
  coord_fixed() +
  scale_fill_gradient(low = "white", high = "deepskyblue2") 
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=20, fig.width=20}
p7
```
