---
output:
  pdf_document: default
  html_document: default
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(ggthemes)
library(stringi)
library(ggplot2)
library(ggdendro)
library(reshape2)
library(grid)
```

### 99 percent

```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=30, fig.width=25}
df_plot <- read.csv("~/master/rumen/dataflow/04-analysis-tables/henderson2015-20_320-99_df_metrics_lacto_1000_df_plot.csv")
df_plot$genus <- as.character(df_plot$genus)
df_plot$family <- as.character(df_plot$family)
df_plot$genus[is.na(df_plot$genus)] <- "None"
df_plot$family[is.na(df_plot$family)] <- "None"

df_plot <- df_plot %>% 
  filter(family != "Lactobacillaceae") %>%
  select(-X, -X.1)

df_plot_select <- df_plot %>% 
  group_by(asv_id, lacto_signal) %>%
  top_n(10, count_norm) %>%
  ungroup() 
  
df_plot_select_rank <- df_plot_select %>%
  
  select(asv_id, lacto_signal, count_norm) %>%
  
  group_by(asv_id, lacto_signal) %>%

  summarise(value = list(count_norm)) %>%

  spread(lacto_signal, value) %>%

  group_by(asv_id) %>%

  mutate(mean_pos = mean(unlist(pos))) %>%
  mutate(mean_neg = mean(unlist(neg))) %>%
  
  ungroup() %>%
  rowwise() %>%
    
  mutate(ratio_pos = mean_pos / mean_neg) %>%

  mutate(ratio_neg = mean_neg / mean_pos) %>%
  
  ungroup() %>%
  
  select(asv_id, ratio_pos, ratio_neg) %>%
  
  distinct() %>%

  gather(direction, ratio, -asv_id)  %>%
  
  filter(ratio > 100) %>%
  
  select(-direction)

df_plot <- df_plot %>%
  inner_join(df_plot_select_rank) 

ggplot(df_plot, aes(x=lacto_signal, y=count_norm)) +
            geom_jitter(aes(colour = lacto_signal), size = 5) +
  facet_wrap(asv_id ~ family, scales="free") +
  theme() +
          theme(strip.text = element_text(size = 25),
          plot.title = element_text(size = 30),
          axis.text.x = element_text(angle = 90, hjust = 1, size = 20),
          axis.text.y = element_text(size = 20),
          axis.title.x = element_text(size = 20),
          axis.title.y = element_text(size = 20)) +
  ylab("Normalized Abundance") +
  xlab("LAB Containing")
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height=3.5, fig.width=3.5}
# for (seq in unique(df_plot$asv_id)){
#   
#   df_plot_sub <- df_plot %>%
#     filter(asv_id == seq)
#   
#   
# plot(ggplot(df_plot_sub, aes(x=lacto_signal, y=count_norm)) +
#             geom_jitter(aes(colour = lacto_signal), size = 5) +
#        theme() +
#           theme(plot.title = element_text(size = 16),
#           axis.text.x = element_text(angle = 90, hjust = 1, size = 10),
#           axis.text.y = element_text(size = 10),
#           axis.title.x = element_text(size = 12),
#           axis.title.y = element_text(size = 12)) +
#        ggtitle(unique(df_plot_sub$family)) + 
#   theme(legend.position="none") +
#   ylab("Normalized Abundance") +
#   xlab("Lactobacillus Containing"))
#   
#   
# }

```
